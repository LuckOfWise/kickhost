/*!
 * jQuery.bgSwitcher
 *
 * @version    0.3.6-beta
 * @author     Hiroshi Hoaki <rewish.org@gmail.com>
 * @copyright  2010-2012 Hiroshi Hoaki
 * @license    http://rewish.org/license/mit The MIT License
 * @link       http://rewish.org/javascript/jquery_bg_switcher
 */
(function(a){a.fn.bgSwitcher=function(c){return this.each(function(){a(this).data("bgSwitcher",new a.bgSwitcher(this,c))})};a.bgSwitcher=function(d,c){this.initialize.apply(this,arguments)};a.bgSwitcher.defaultOptions={images:null,interval:5000,autoStart:true,duration:1000,easing:"linear",loop:true,random:false,resize:true,switchHandler:function(){this.node.fadeOut(this.options.duration,this.options.easing)}};a.bgSwitcher.prototype={initialize:function(d,c){this.node=a(d);this.setOptions(c);this.preload();this.index=-1;this.next=this.options.random?this.random:this.order;this.next();this.normalSwitch(this.options.images[this.index]);if(this.options.duration>0){this.initCloneNode();this.doSwitch=this.fadeSwitch}else{this.doSwitch=this.normalSwitch}if(this.options.autoStart){this.start()}},setOptions:function(c){this.options=a.extend(true,{},a.bgSwitcher.defaultOptions,c);if(!(this.options.images instanceof Array)){throw new Error("options.images is invalid.")}if(typeof this.options.images[0]==="string"&&typeof this.options.images[1]==="number"&&typeof this.options.images[2]==="number"){this.sequence()}if(this.options.images.length<=1){throw new Error("Image must be at least more than two.")}if(this.options.fadeSpeed!=null){this.options.duration=this.options.fadeSpeed}},start:function(){if(this.timeId){return}var c=this;this.timeId=setInterval(function(){c.next();c.doSwitch(c.options.images[c.index])},c.options.interval)},stop:function(){if(this.timeId){clearInterval(this.timeId);this.timeId=null}},toggle:function(){if(this.timeId){this.stop()}else{this.start()}},reset:function(){this.index=0;this.stop();this.doSwitch(this.options.images[this.index]);this.start()},order:function(){var c=this.options.images.length;++this.index;if(this.index===c){this.index=0}if(!this.options.loop&&this.index>=c-1){this.stop()}},random:function(){var d=this.options.images.length,c=this.index;while(this.index===c){c=Math.floor(Math.random()*d)}this.index=c},sequence:function(){var e=[],f=this.options.images[0],d=this.options.images[1],c=this.options.images[2];do{e.push(f.replace(/\.\w+$/,d+"$&"))}while(++d<=c);this.options.images=e},preload:function(){if(this.loadedImages==null){this.loadedImages={}}var d=0,c=this.options.images,e=c.length,f;for(;d<e;++d){f=c[d];this.loadedImages[f]=new Image;this.loadedImages[f].src=f}},initCloneNode:function(){var c=this.node[0].tagName.toLowerCase();if(c==="html"){throw new Error("FadeOut the HTML not allowed.")}if(c==="body"){this.initRootNode();c="div"}var e=this.node.css("zIndex"),d=this.node.offset();if(isNaN(e)){e=1000;this.node.css({zIndex:e})}this.cloneNode=a("<"+c+">");this.cloneNode.css({display:"block",position:"absolute",zIndex:e-2,top:d.top,left:d.left,width:this.node.innerWidth(),height:this.node.innerHeight(),backgroundImage:this.node.css("backgroundImage"),backgroundPosition:b(this.node),backgroundRepeat:this.node.css("backgroundRepeat"),backgroundColor:this.node.css("backgroundColor"),backgroundAttachment:this.node.css("backgroundAttachment")});this.origNode=this.node;this.origNode.css({position:"relative",background:"none"});this.node=this.cloneNode.clone();this.node.css("zIndex",e-1);this.origNode.after(this.cloneNode,this.node);if(this.options.resize){a(window).bind("resize.bgSwitcher",a.proxy(this.resizeHandler,this))}},initRootNode:function(){var c,e,g,f,d,h;c=a("> *",this.node).not("script");c.find("script").remove();c=c.wrapAll("<div>").parent();e=this.node;g={backgroundImage:e.css("backgroundImage"),backgroundPosition:b(e),backgroundRepeat:e.css("backgroundRepeat"),backgroundColor:e.css("backgroundColor"),backgroundAttachment:e.css("backgroundAttachment")};f=["Top","Bottom","Right","Left"];for(d=0;d<4;++d){h="padding"+f[d];g[h]=+e.css("margin"+f[d]).replace(/\D/g,"");g[h]+=+e.css("padding"+f[d]).replace(/\D/g,"");g[h]+="px"}c.css(g);e.css({margin:0,padding:0,background:"none"});this.node=c;this.options.resize=true},resizeHandler:function(){var d=this.origNode.offset(),c={width:this.origNode.innerWidth(),top:d.top,left:d.left};this.node.css(c);this.cloneNode.css(c)},normalSwitch:function(c){this.node.css("backgroundImage","url("+c+")")},fadeSwitch:function(d){var c=this;this.node.stop(true,true);this.node.css("backgroundImage",this.cloneNode.css("backgroundImage"));this.node.show(0,function(){c.cloneNode.css("backgroundImage","url("+d+")");c.options.switchHandler.call(c)})}};function b(c){c=a(c);var g,e=0,f="backgroundPosition",d=c.css(f);if(d!==undefined&&d!=="0% 0%"){return d}g=c.css(f+"Y").split(", ");if(g===undefined){return d}d=c.css(f+"X").split(", ");for(;e<d.length;e++){d[e]+=" "+g[e]}return d.join(", ")}})(jQuery);